<div class="container">
  <h1>Relatório de Produtos</h1>

  <div class="filters">
    <label for="manuf">Fabricante</label>
    <select id="manuf" [(ngModel)]="selectedManufacturerId" (ngModelChange)="onFilterChange()">
      <option [ngValue]="null">Todos</option>
      <option *ngFor="let f of manufacturers" [ngValue]="f.id">{{ f.nome }}</option>
    </select>

    <label for="pagesize">Itens por página</label>
    <select id="pagesize" [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange()">
      <option [ngValue]="5">5</option>
      <option [ngValue]="10">10</option>
      <option [ngValue]="20">20</option>
      <option [ngValue]="50">50</option>
    </select>

    <button (click)="exportCsv()">Exportar CSV</button>
    <button (click)="loadProducts()">Atualizar</button>
  </div>

  <div *ngIf="loading" class="loading">Carregando...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="!loading && groups.length === 0">Nenhum produto encontrado para o filtro.</div>

  <section *ngFor="let g of groups" class="group">
    <div class="group-header">
      <h2>{{ g.manufacturerName }} <small>({{ g.items.length }} itens)</small></h2>
      <button (click)="exportGroupCsv(g.manufacturerId)">Exportar CSV (grupo)</button>
    </div>

    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Descrição</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of pagedItemsForGroup(g.manufacturerId)">
            <td>{{ p.id }}</td>
            <td>{{ p.nome }}</td>
            <td>{{ p.descricao || '-' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <app-pagination
      [page]="pageForGroup(g.manufacturerId)"
      [totalPages]="totalPagesForGroup(g.manufacturerId)"
      (pageChange)="setPageForGroup(g.manufacturerId, $event)"
    ></app-pagination>
  </section>
</div>
